<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>專業 POS 生鮮系統</title>

<style>
body{margin:0;font-family:"Microsoft JhengHei",Arial,sans-serif;background:#f5f5f5;}
button{cursor:pointer;outline:none;transition:0.2s;}
#posApp{display:flex;height:100vh;}

/* =========================
   分類（左右滑動）
   ========================= */
#posCategories{
  width:20%;
  background:#3498db;
  padding:10px;
  color:white;
  overflow-x:auto;
  overflow-y:hidden;
  white-space:nowrap;
  display:flex;
  flex-direction:column;
  gap:10px;
}

#posCategories button{
  display:inline-block;
  width:auto;
  padding:10px 14px;
  font-size:0.9rem;
  border:none;border-radius:20px;
  background:#2980b9;
  color:white;
  margin-right:8px;
}

#posCategories button.active{
  background:#f1c40f;color:#2c3e50;
}

/* =========================
   商品區
   ========================= */
#posProducts{
  flex:1;padding:15px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(130px,1fr));
  gap:12px;
  overflow-y:auto;
  grid-auto-rows:200px; /* 固定高度 */
}

.product-card{
  position:relative;
  background:white;
  border-radius:12px;
  padding:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
  display:flex;
  flex-direction:column;
  text-align:center;
  cursor:pointer;
  transition:0.15s;
}

.product-card:active{
  transform:scale(0.96);
}

/* 釘選 */
.product-pin{
  position:absolute;
  top:6px;right:6px;
  font-size:20px;
  color:#ccc;
  user-select:none;
}
.product-pin.active{
  color:#f1c40f;
}

/* 促銷 TAG */
.product-tag{
  position:absolute;
  left:6px;top:6px;
  background:#e74c3c;
  color:white;
  padding:2px 6px;
  font-size:0.75rem;
  border-radius:6px;
}

/* 商品圖片正方形 */
.product-card img{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  border-radius:8px;
}

.product-card h4{
  margin:4px 0 0 0;
  font-size:0.9rem;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.product-card p{
  margin:2px 0 0 0;
  color:#666;
  font-size:0.8rem;
}

@media(max-width:980px){
  #posProducts{grid-template-columns:repeat(auto-fill,minmax(120px,1fr));grid-auto-rows:180px;}
}
@media(max-width:600px){
  #posProducts{grid-template-columns:repeat(auto-fill,minmax(100px,1fr));grid-auto-rows:160px;}
}
@media(max-width:420px){
  #posProducts{grid-template-columns:repeat(auto-fill,minmax(90px,1fr));grid-auto-rows:150px;}
}

/* =========================
   訂單明細
   ========================= */
#posCartContainer{
  width:28%;
  background:#f7f7f7;
  padding:10px;
  display:flex;
  flex-direction:column;
  border-left:2px solid #ddd;
}

#posCart{flex:1;overflow-y:auto;}

.cart-item{
  background:white;
  border-radius:8px;
  padding:8px;
  margin-bottom:10px;
}

.cart-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.cart-name{
  font-size:0.95rem;
  font-weight:600;
}

.cart-qty{
  color:#2980b9;
  cursor:pointer;
}

.cart-delete{
  background:#e74c3c;
  color:white;
  font-size:0.8rem;
  padding:2px 6px;
  border:none;border-radius:4px;
}

.cart-sub{
  margin-top:5px;
  font-size:0.9rem;
}

/* =========================
   數字鍵盤彈窗
   ========================= */
#editModal{
  display:none;
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.5);
  justify-content:center;align-items:center;
  z-index:9999;
}

.modalContent{
  background:white;
  padding:20px;
  border-radius:12px;
  width:320px;
  text-align:center;
  animation:popup 0.18s ease-out;
}

@keyframes popup{
  0%{transform:scale(0.8);opacity:0;}
  100%{transform:scale(1);opacity:1;}
}

.modalContent input{
  width:80px;
  text-align:center;
  font-size:1.3em;
  margin:5px;
  border:2px solid #ccc;
  border-radius:6px;
}

#numpad{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:5px;
  margin-top:10px;
}

#numpad button{
  padding:15px;font-size:1.2em;
  background:#3498db;color:white;
  border:none;border-radius:6px;
}

.modalActions button{
  padding:12px;
  border:none;border-radius:6px;
  font-size:1em;
  margin-top:10px;
}

.confirm{background:#27ae60;color:white;}
.cancel{background:#e74c3c;color:white;}
</style>
</head>

<body>

<div id="posApp">
  
  <!-- 分類 -->
  <div id="posCategories"></div>

  <!-- 商品 -->
  <div id="posProducts"></div>

  <!-- 訂單明細 -->
  <div id="posCartContainer">
    <h3>訂單明細</h3>
    <div id="posCart"></div>
    <p>總額：<span id="posTotal">0</span> 元</p>
    <button id="posCheckout">結帳</button>
  </div>

</div>

<!-- 數字鍵盤 -->
<div id="editModal">
  <div class="modalContent">
    <h4 id="modalProductName">商品名稱</h4>
    <div>
      <label>數量:</label>
      <input id="modalQty" type="text" readonly>
    </div>
    <div>
      <label>單價:</label>
      <input id="modalPrice" type="text" readonly>
    </div>

    <div id="numpad">
      <button onclick="numpadPress('1')">1</button>
      <button onclick="numpadPress('2')">2</button>
      <button onclick="numpadPress('3')">3</button>
      <button onclick="numpadPress('4')">4</button>
      <button onclick="numpadPress('5')">5</button>
      <button onclick="numpadPress('6')">6</button>
      <button onclick="numpadPress('7')">7</button>
      <button onclick="numpadPress('8')">8</button>
      <button onclick="numpadPress('9')">9</button>
      <button onclick="numpadPress('0')">0</button>
      <button onclick="numpadBack()">←</button>
      <button onclick="switchField()">切換</button>
    </div>

    <button class="confirm" onclick="confirmEdit()">確定</button>
    <button class="cancel" onclick="closeModal()">取消</button>
  </div>
</div>


<script>
const API_URL="YOUR_API_URL";
let products=[], categories=[], posCart=[];
let editIndex=null;
let editingField="qty";

/* ===========================
   取得商品資料
   =========================== */
async function fetchProducts(){
  const res = await fetch(API_URL+"?action=products");
  products = await res.json();
  categories=[...new Set(products.map(p=>p['類別']))];
  renderCategories();
  renderProducts(categories[0]);
}

/* ===========================
   分類按鈕
   =========================== */
function renderCategories(){
  const el=document.getElementById("posCategories");
  el.innerHTML="";
  categories.forEach(cat=>{
    const btn=document.createElement("button");
    btn.textContent=cat;
    btn.onclick=()=>{
      document.querySelectorAll("#posCategories button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      renderProducts(cat);
    };
    el.appendChild(btn);
  });
  el.querySelector("button").classList.add("active");
}

/* ===========================
   商品區
   =========================== */
function renderProducts(category){
  const box=document.getElementById("posProducts");
  box.innerHTML="";
  products
    .filter(p=>p['類別']===category)
    .sort((a,b)=>(b.favorite?1:0)-(a.favorite?1:0))
    .forEach(p=>{
      const card=document.createElement("div");
      card.className="product-card";
      card.innerHTML=`
        ${p.tag?`<div class="product-tag">${p.tag}</div>`:""}
        <div class="product-pin ${p.favorite?"active":""}" onclick="toggleFavorite('${p['商品名稱']}');event.stopPropagation();">★</div>
        <img src="${p['商品照片']}">
        <h4>${p['商品名稱']}</h4>
        <p>${p['售價']} 元 / ${p['單位']}</p>
      `;
      
      card.onclick=()=>addItem(p);
      box.appendChild(card);
    });
}

function toggleFavorite(name){
  const item=products.find(p=>p['商品名稱']===name);
  item.favorite = !item.favorite;
  renderProducts(document.querySelector("#posCategories button.active").textContent);
}

/* ===========================
   加入訂單
   =========================== */
function addItem(p){
  const exist=posCart.find(i=>i.name===p['商品名稱']);
  if(exist) exist.qty++;
  else posCart.push({
    name:p['商品名稱'],
    unit:p['單位'],
    price:Number(p['售價']),
    qty:1
  });
  renderCart();
}

/* ===========================
   渲染訂單
   =========================== */
function renderCart(){
  const box=document.getElementById("posCart");
  box.innerHTML="";
  let total=0;

  posCart.forEach((item,idx)=>{
    const sub=item.qty*item.price;
    total+=sub;

    const div=document.createElement("div");
    div.className="cart-item";
    div.innerHTML=`
      <div class="cart-row">
        <span class="cart-name">${item.name} x<span class="cart-qty" onclick="openModal(${idx},'qty')">${item.qty}(${item.unit})</span></span>
        <button class="cart-delete" onclick="deleteItem(${idx})">刪除</button>
      </div>
      <div class="cart-sub">小計：${sub}</div>
    `;
    box.appendChild(div);
  });

  document.getElementById("posTotal").textContent=total;
}

function deleteItem(i){
  posCart.splice(i,1);
  renderCart();
}

/* ===========================
   數字鍵盤
   =========================== */
function openModal(index, field){
  editIndex=index;
  editingField=field;
  const item=posCart[index];
  document.getElementById("modalProductName").textContent=item.name;
  document.getElementById("modalQty").value=item.qty;
  document.getElementById("modalPrice").value=item.price;
  document.getElementById("editModal").style.display="flex";
}

function closeModal(){
  document.getElementById("editModal").style.display="none";
}

function switchField(){
  editingField=editingField==="qty"?"price":"qty";
}

function numpadPress(n){
  const el=document.getElementById(editingField==="qty"?"modalQty":"modalPrice");
  el.value = (el.value==="0"?n:el.value+n);
}

function numpadBack(){
  const el=document.getElementById(editingField==="qty"?"modalQty":"modalPrice");
  el.value=el.value.slice(0,-1)||"0";
}

function confirmEdit(){
  const q=Number(document.getElementById("modalQty").value);
  const p=Number(document.getElementById("modalPrice").value);
  posCart[editIndex].qty=Math.max(1,q);
  posCart[editIndex].price=Math.max(0,p);
  closeModal();
  renderCart();
}

/* ===========================
   初始化
   =========================== */
fetchProducts();
</script>

</body>
</html>




